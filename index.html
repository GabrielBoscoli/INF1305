<!DOCTYPE html>
<html>
	<head>
		<title>Bet Contract</title>
		<meta charset="UTF-8">
		<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>
		<script type="text/javascript">
			const contract_address = "0xAB8a2bcCeD6d100A956834165042F0DefbFf6EF8";

			const contract_abi = [
				{
					"type": "function",
					"name": "createBetWithParticipant",
					"inputs": [
						{
							"name": "_betText",
							"type": "string"
						},
						{
							"name": "_amount",
							"type": "uint256"
						},
						{
							"name": "_owner",
							"type": "address"
						},
						{
							"name": "_participant",
							"type": "address"
						},
						{
							"name": "_participantAmount",
							"type": "uint256"
						},
						{
							"name": "_referee",
							"type": "address"
						},
						{
							"name": "_refereeTip",
							"type": "uint256"
						},
						{
							"name": "_refereeDeadline",
							"type": "uint256"
						},
					],
					"outputs": [
						{
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "payable"
				},
				{
					"type": "function",
					"name": "createBet",
					"inputs": [
						{
							"name": "_betText",
							"type": "string"
						},
						{
							"name": "_amount",
							"type": "uint256"
						},
						{
							"name": "_owner",
							"type": "address"
						},
						{
							"name": "_participantAmount",
							"type": "uint256"
						},
						{
							"name": "_refereeTip",
							"type": "uint256"
						},
						{
							"name": "_refereeDeadline",
							"type": "uint256"
						},
					],
					"outputs": [
						{
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "payable"
				},
				{
					"type": "function",
					"name": "cancelBet",
					"inputs": [
						{
							"name": "_betId",
							"type": "uint256"
						}
					],
					"outputs": [],
					"stateMutability": "nonpayable"
				},
				{
					"type": "function",
					"name": "participantAcceptBet",
					"inputs": [
						{
							"name": "_betId",
							"type": "uint256"
						}
					],
					"outputs": [],
					"stateMutability": "payable"
				},
				{
					"type": "function",
					"name": "refereeAcceptBet",
					"inputs": [
						{
							"name": "_betId",
							"type": "uint256"
						},
						{
							"name": "_refereeWarranty",
							"type": "uint256"
						}
					],
					"outputs": [],
					"stateMutability": "payable"
				},
				{
					"type": "function",
					"name": "exceededDeadline",
					"inputs": [
						{
							"name": "_betId",
							"type": "uint256"
						}
					],
					"outputs": [],
					"stateMutability": "nonpayable"
				},
				{
					"type": "function",
					"name": "checkContractBalance",
					"inputs": [],
					"outputs": [
						{
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view"
				},
				{
					"type": "function",
					"name": "bets",
					"inputs": [
						{
							"name": "_betId",
							"type": "uint256"
						}
					],
					"outputs": [
						{
							"name": "",
							"type": "tuple",
							"components": [
								{
									"name": "id",
									"type": "uint256"
								},
								{
									"name": "owner",
									"type": "address"
								},
								{
									"name": "ownerAmount",
									"type": "uint256"
								},
								{
									"name": "participant",
									"type": "address"
								},
								{
									"name": "participantAmount",
									"type": "uint256"
								},
								{
									"name": "participantAccepted",
									"type": "bool"
								},
								{
									"name": "referee",
									"type": "address"
								},
								{
									"name": "refereeTip",
									"type": "uint256"
								},
								{
									"name": "refereeAccepted",
									"type": "bool"
								},
								{
									"name": "refereeDeadline",
									"type": "uint256"
								},
								{
									"name": "betText",
									"type": "string"
								},
							]
						}
					],
					"stateMutability": "view"
				}
			];

			const ethEnabled = () => {
				if (window.ethereum) {
					window.web3 = new Web3(window.ethereum);
					window.ethereum.enable();
					return true;
				}
				return false;
			}

			async function saveCoinbase () {
				window.coinbase = await window.web3.eth.getCoinbase();
			};

			async function getAndShowVal () {
				var val = window.SimpleStorage.methods.get().call();
				document.getElementById("storedData").value = await val;
			};

			async function setVal () {
				var val = document.getElementById("storedData").value;
				window.SimpleStorage.methods.set(val).send(val, {from:window.coinbase});
			}

			async function createBetWithParticipant () {
				var betText = document.getElementById("betTextForCreateBetWithParticipant").value;
				var amount = document.getElementById("amountForCreateBetWithParticipant").value;
				var owner = document.getElementById("ownerForCreateBetWithParticipant").value;
				var participant = document.getElementById("participant").value;
				var participantAmount = document.getElementById("participantAmountForCreateBetWithParticipant").value;
				var referee = document.getElementById("referee").value;
				var refereeTip = document.getElementById("refereeTipForCreateBetWithParticipant").value;
				var refereeDeadline = document.getElementById("refereeDeadlineForCreateBetWithParticipant").value;
				var val = window.BetContract.methods.createBetWithParticipant(betText, amount, owner, participant, participantAmount, referee, refereeTip, refereeDeadline).send({from:window.coinbase, to: contract_address, value: amount});
				document.getElementById("createdBetWithParticipantId").innerHTML = await val;
			}

			async function createBet () {
				var betText = document.getElementById("betTextForCreateBet").value;
				var amount = document.getElementById("amountForCreateBet").value;
				var owner = document.getElementById("ownerForCreateBet").value;
				var participantAmount = document.getElementById("participantAmountForCreateBet").value;
				var refereeTip = document.getElementById("refereeTipForCreateBet").value;
				var refereeDeadline = document.getElementById("refereeDeadlineForCreateBet").value;
				var val = window.BetContract.methods.createBet(betText, amount, owner, participantAmount, refereeTip, refereeDeadline).send({from:window.coinbase, to: contract_address, value: amount});
				document.getElementById("createdBetId").innerHTML = await val;
			}

			async function cancelBet () {
				var betId = document.getElementById("betIdForCancelBet").value;
				window.BetContract.methods.cancelBet(betId).send({from:window.coinbase});
			}

			async function participantAcceptBet () {
				var betId = document.getElementById("betIdForParticipantAcceptBet").value;
				var amount = document.getElementById("amountForParticipantAcceptBet").value;
				window.BetContract.methods.participantAcceptBet(betId).send({from:window.coinbase, to: contract_address, value: amount});
			}

			async function participantDeclineBet () {
				var betId = document.getElementById("betIdForParticipantDeclineBet").value;
				window.BetContract.methods.participantDeclineBet(betId).send({from:window.coinbase});
			}

			async function refereeAcceptBet () {
				var betId = document.getElementById("betIdForRefereeAcceptBet").value;
				var warranty = document.getElementById("refereeWarranty").value;
				var amount = document.getElementById("amountForRefereeAcceptBet").value;
				window.BetContract.methods.refereeAcceptBet(betId, warranty).send({from:window.coinbase, to: contract_address, value: amount});
			}

			async function refereeDeclineBet () {
				var betId = document.getElementById("betIdForRefereeDeclineBet").value;
				window.BetContract.methods.refereeDeclineBet(betId).send({from:window.coinbase, to: contract_address, value: amount});
			}

			async function defineWinner () {
				var betId = document.getElementById("betIdForDefineWinner").value;
				var winner = document.getElementById("winner").value;
				window.BetContract.methods.refereeAcceptBet(betId, winner).send({from:window.coinbase});
			}

			async function exceededDeadline () {
				var betId = document.getElementById("betIdForExceededDeadline").value;
				window.BetContract.methods.exceededDeadline(betId).send({from:window.coinbase});
			}

			if (!ethEnabled()) {
			alert("Metamask or browser with Ethereum not detected!");
			}
			else {
				window.BetContract = new web3.eth.Contract(contract_abi, contract_address);
				saveCoinbase();
			}

		</script>
	</head>
	<body>
		<div>
			<h1>Create Bet With Participant</h1>
			Bet Text: <input type="text" name="betTextForCreateBetWithParticipant" id="betTextForCreateBetWithParticipant"><br>
			Amount: <input type="text" name="amountForCreateBetWithParticipant" id="amountForCreateBetWithParticipant"><br>
			Owner: <input type="text" name="ownerForCreateBetWithParticipant" id="ownerForCreateBetWithParticipant"><br>
			Participant: <input type="text" name="participant" id="participant"><br>
			Participant Amount: <input type="text" name="participantAmountForCreateBetWithParticipant" id="participantAmountForCreateBetWithParticipant"><br>
			Referee: <input type="text" name="referee" id="referee"><br>
			Referee Tip: <input type="text" name="refereeTipForCreateBetWithParticipant" id="refereeTipForCreateBetWithParticipant"><br>
			Referee Deadline <input type="text" name="refereeDeadlineForCreateBetWithParticipant" id="refereeDeadlineForCreateBetWithParticipant"><br><br>
			<button id="createBetWithParticipant" onclick="createBetWithParticipant()">Create Bet With Participant</button><br>
			Created Bet Id: <span id="createdBetWithParticipantId">-</span>
		</div>
		<div>
			<h1>Create Bet Without Participant</h1>
			Bet Text: <input type="text" name="betTextForCreateBet" id="betTextForCreateBet"><br>
			Amount: <input type="text" name="amountForCreateBet" id="amountForCreateBet"><br>
			Owner: <input type="text" name="ownerForCreateBet" id="ownerForCreateBet"><br>
			Participant Amount: <input type="text" name="participantAmountForCreateBet" id="participantAmountForCreateBet"><br>
			Referee Tip: <input type="text" name="refereeTipForCreateBet" id="refereeTipForCreateBet"><br>
			Referee Deadline <input type="text" name="refereeDeadlineForCreateBet" id="refereeDeadlineForCreateBet"><br><br>
			<button id="createBetWithParticipant" onclick="createBet()">Create Bet Without Participant</button><br>
			Created Bet Id: <span id="createdBetId">-</span>
		</div>
		<div>
			<h1>Cancel Bet</h1>
			Bet Id: <input type="text" name="betIdForCancelBet" id="betIdForCancelBet"><br><br>
			<button id="cancelBet" onclick="cancelBet()">Cancel Bet</button><br>
		</div>
		<div>
			<h1>Participant Accepts Bet</h1>
			Bet Id: <input type="text" name="betIdForParticipantAcceptBet" id="betIdForParticipantAcceptBet"><br>
			Amount: <input type="text" name="amountForParticipantAcceptBet" id="amountForParticipantAcceptBet"><br><br>
			<button id="participantAcceptBet" onclick="participantAcceptBet()">Participant Accept Bet</button><br>
		</div>
		<div>
			<h1>Participant Declines Bet</h1>
			Bet Id: <input type="text" name="betIdForParticipantDeclineBet" id="betIdForParticipantDeclineBet"><br><br>
			<button id="participantDeclineBet" onclick="participantDeclineBet()">Participant Decline Bet</button><br>
		</div>
		<div>
			<h1>Referee Accepts Bet</h1>
			Bet Id: <input type="text" name="betIdForRefereeAcceptBet" id="betIdForRefereeAcceptBet"><br>
			Referee Warranty: <input type="text" name="refereeWarranty" id="refereeWarranty"><br>
			Amount: <input type="text" name="amountForRefereeAcceptBet" id="amountForRefereeAcceptBet"><br><br>
			<button id="refereeAcceptBet" onclick="refereeAcceptBet()">Referee Accept Bet</button><br>
		</div>
		<div>
			<h1>Referee Declines Bet</h1>
			Bet Id: <input type="text" name="betIdForRefereeDeclinesBet" id="betIdForRefereeDeclinesBet"><br><br>
			<button id="refereeDeclineBet" onclick="refereeDeclineBet()">Referee Decline Bet</button><br>
		</div>
		<div>
			<h1>Define Winner</h1>
			Bet Id: <input type="text" name="betIdForDefineWinner" id="betIdForDefineWinner"><br>
			Winner: <input type="text" name="winner" id="winner"><br><br>
			<button id="defineWinner" onclick="defineWinner()">Define Winner</button><br>
		</div>
		<div>
			<h1>Exceeded Deadline</h1>
			Bet Id: <input type="text" name="betIdForExceededDeadline" id="betIdForExceededDeadline"><br><br>
			<button id="exceededDeadline" onclick="exceededDeadline()">Exceeded Deadline</button><br>
		</div>
	</body>
</html>